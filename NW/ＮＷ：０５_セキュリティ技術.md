# ＮＷ：０５_セキュリティ技術
## 概念
### 規格 JIS Q 27000（ISO／IEC 27000）によると、情報セキュリティは、情報の機密性、安全性及び可用性を維持すること
#### ポイント
##### 物理的
###### ファイアウオール、IDS、IPS、ルーティングルールなど
##### 社会的
###### 一般社員を含む、組織全員で、守るベキルール（情報セキュリティポリシ）を決めて、守るの仕組み
#### CIA：Confidentiality、Integrity、Availability
##### 機密性：Confidentiality
###### 認可されていない個人、エンティティまたはプロセスに対して、情報を使用されず、または開示しない特性
##### 完全性：Integrity
###### 正確さ及び完全さの特性
##### 可用性：Availability
###### 認可されたエンティティが要求したときに、アクセス及び使用が可能である特性
##### 真正性：Authenticity
###### エンティティは、それが主張する通りのものであるという特性
##### 責任追跡性：Accountability
###### あるエンティティの動作が一意に追跡できる特性
##### 否認防止：Non−Repudiation
###### 主張された事象または処置の発生、及びそれを引き起こしたエンティティを証明する能力
##### 信頼性：Reliability
###### 意図する行動と結果とが一致しているという特性
#### 不正のメカニズム
##### 米国の犯罪学者であるD.R.グレッシーが提唱している不正のトライアングルリ理論
###### 不正リスクの3要素
* 機会
    * 不正行為を実行が可能、または容易となる環境
* 動機
    * 不正行為を行うための事情
* 正当化
    * 不正行為を行うための良心の呵責を乗り越える理由
##### 英国で提唱された状況的犯罪予防論
###### 五つの観点
* 物理的にやりにくい状況を作る
* やると見つかる状況を作る
* やっても割りに合わない状況を作る
* その気にさせない状況を作る
* 言い訳を許さない状況を作る
#### 攻撃者の種類と動機
##### 種類
###### スクリプトキディ
* インターネット上で公開されている簡単なクラッキングツールを利用して不正アクセスを試しみ攻撃者
###### ボットハーダー
* ボットを利用することでサイバー攻撃などを実行する攻撃者
###### 内部関係者
* 従業員や業務先社員など、アクセス権限を悪用して攻撃
###### そのた、愉快犯、詐欺犯、故意犯などもある
##### 動機
###### 金銭奪取
* 金銭敵に不当な利益を得ることを目的に行われる攻撃
###### ハクティビズム
* 政治的・社会的な思想に基づき積極敵にハッキングを行う
###### サイバーテロリズム
* ネットワークを対象に行われるテロリズム
## 情報セキュリティマネジメント
### ISMS：Information Security Management System
#### 組織における情報セキュリティを管理するための仕組み
##### JIS Q 27001（ISO／IEC 27001）で構築方法や要求事項を示す
#### 情報セキュリティ基本方式、PDCAサイクルを繰り返す
##### Plan
###### 情報セキュリティ対策の具体的計画を策定する
##### Do
###### 計画に基づいて、対策の導入・運用を行う
##### Check
###### 実施した結果の監視・監査及び見直しを行う
##### Act
###### 経営陣による改善・処置を行う
### 情報資産・脅威・脆弱性
#### 資産
##### 企業等が所有する、業務に必要な価値のあるもの
###### 商品や不動産など形のあるものだけでなく、顧客情報や技術情報などの情報資産も含まれる
#### 脅威
##### システムや組織に損害を与える可能性があるインシデントの潜在的な原因
#### 脆弱性
##### 脅威が漬け込みことができる、資産が持つ弱点
### リスクマネジメント
#### リスク
##### 発生すれば、情報資産に影響を与える不確実な事象や状態のこと
#### リスクを特定し、分析結果をもとに優先度をつけ、それぞれの守る、方針を決め、セキュリティポリシーを作成
### 情報セキュリティポリシ
#### 組織の情報資産を守るための方針や基準を明文化したもの
##### 情報セキュリティ基本方針
###### 経営陣によって承認され、目的や対象範囲、管理体制や罰則などについて記述されており、全従業員及び関係者に通知して公表する．
##### 情報セキュリティ対策基準
###### リスクアセスメントの結果に基づいて対策基準を決め、適切な情報セキュリティレベルを維持・確保するための具体的な遵守するための具体的な遵守事項や基準
### セキュリティ評価基準
#### ISO／IEC 15408（JIS X 5070）規格、CC（Common Criteria：コモンクライテリア）
##### 主な概念
###### ST：Security Target：セキュリティターゲット
* セキュリティ基本設計書、利用者が自分の要求仕様を文書化したものです
###### EAL：Evaluation Assurance Level：評価保証レベル
* 製品の保証要件を示す、客観的に評価するための指標
    * EAL1：機能テスト
    * EAL2：構造テスト
    * EAL3：方式テスト及びチェック
    * EAL4：方式設計、テスト及びレビュー
    * EAL5：準形式的設計及びテスト
    * EAL6：準形式検証済み設計及びテスト
    * EAL7：形式的な設計の検証及びテスト
### 情報セキュリティ委員会
#### 組織の中における、情報セキュリティ管理責任者（CISO：Chief Information Security Officer）をはじめとした経営層の意思決定組織
##### 情報セキュリティにかかわる企業のビジョンを策定し、情報セキュリティポリシの決定や承認などを行う
### CSIRT：Computer Security Incident  Response Team
#### 主にセキュリティ対策のためにコンピュータやネットワークを監視、問題が発生した際にはその原因の解析や調査を行う組織
##### 組織内シーサート：Internal CSIRT
###### 各企業や公共団体などで、組織ごとのインシデントに対応する組織
##### 国際連携シーサート：National CSIRT
###### 国や地域を代表する形で組織内シーサートと連携し、問い合わせ窓口となる組織
##### コーディネーションセンター：Coordination Center
###### 他のCSIRTとの情報連携や調整を行う組織．日本のはJPCERT／CC（Japan Computer Emergency  Response Team Coordination Center）
### IPAセキュリティセンター
#### 情報セキュリティ早期警戒パートナーシップという制度を運用して、コンピュータウイルス、不正アクセス、脆弱性などの届出を受け付けている
##### 情報セキュリティに関するさまざまな情報を発信し、再発防止のための提言や、啓発活動を行なっている
### 内閣サイバーセキュリティセンター：NISC：National center of Incident readiness and Strategy for Cybersecurity
#### 内閣官房に設置された組織、セイバーセキュリティ基本法に基づき、内閣にサイバー戦略本部が設置され、同時に内閣官房にNISCが設置され、サイバーセキュリティ戦略の立案と実施の推進などを行う
### CRYPTREC：Cryptography Research and Evaluation Committees
#### 電子政府推奨暗号の安全性を評価・監視し、暗号技術の適切な実装方や運用法を調査・検討するプロジェクトです
##### 「電子政府における調達のために参照すべき暗号リスト」（CRYPTREC暗号リスト）を公開している
###### 電子政府推奨暗号リスト
* 安全性及び実装性能が確認され、市場における利用実績が十分であるか今後の普及が見込みまれる都判断されるもののリスト
###### 推奨候補暗号リスト
* 安全性及び実装性能が確認され、今後、電子政府推奨暗号リストに掲載される可能性のある暗号技術のリスト
###### 運用監視暗号リスト
* 推奨すべき状態ではなくなった暗号技術、互換性維持のために継続利用を容認する者のリスト
### 情報セキュリティの継続
#### 機器または災害発生のような非常事態に備えて、組織は、継続した情報セキュリティの運用を確実にするためのプロセス
##### 具体的には、コンティンジェンシープラン（緊急時対応計画）や復旧計画、バックアップ対策などを事前に考案している
## セキュリティ技術
### 暗号化技術
#### 鍵を利用して暗復号を行う、暗号化するときの鍵は暗号鍵、復号するときの鍵は復号鍵と呼ばれ
##### 共通鍵暗号方式
###### 暗復号で同じ鍵を利用する、暗号化する経路の数だけ鍵が必要です
###### 代表的な方式
* ブロック暗号
    * DES：Data Encryption Standard
        * 米国の旧国家規格であり、56ビットの鍵を使う．脆弱性があり、代替として3DESなどを利用している
    * AES：Advanced Encryption Standard
        * NISTが規格化した新世代標準、DESの後継であり、鍵長は128ビット、192ビット、256ビットのみつが利用される．排他の論理和の演算を繰り返して、その演算の数を段数（ラウンド数）と言い、利用する鍵によって段数が決まり、段数が多い方が安全性がより高くなる
* ストリーム暗号
    * RC4：Rivest‘s Cipher 4
        * ビット単位で少しずつでも暗号化を行う、処理が高速であり、無線LANのアルゴリズムであるWEPなどで使用されている
#####  公開鍵暗号方式（非対称暗号方式）
###### 暗号化鍵と復号化鍵が異なる方式、使用する人ごとに公開鍵と秘密鍵のペア（キーペア）を作り、それで、公開鍵は相手に渡す、秘密鍵は自分だけで保管する
* 通信：公開鍵暗号→秘密鍵復号
* 署名：秘密鍵暗号→公開鍵復号
    * 秘密鍵は本人しか持つないもので、この方法で本人であることを外部の人を公開鍵より確認できる、非対称暗号の効率が悪いので、一般的にハッシュと併用している
###### 代表例
* RSA：Rivest Shamir Adleman
    * 大きい数での素因数分解の困難さを安全性の根拠とした方式
* 楕円曲線暗号：Elliptic Curve Cryptography：ECC
    * 楕円曲線上の離散対数問題を安全の根拠とした方式、RSAの後継として注目され
#### ハッシュ
##### 一方向性の関数であるハッシュ関数を用いる方法、暗号化（ハッシュ）化はできても元に戻せないという性質を持っている
###### データを復元させたくない時に利用
* 改ざん検出
    * 代表例
        * MD5：Message Digest Algorithm 5
            * 128ビットのハッシュ出力関数、論理的な弱点が見つかっている
        * SHA1：Secure Hash Algorithm 1
            * NIST規格化した、160ビットのハッシュ出力関数．脆弱性があり、既に攻撃手法が見つかっている
        * SHA2
            * SHA1の後継で、NIST規格したハッシュ関数、それぞれ224ビット、256ビット、384ビット、512ビットのハッシュ値を出力するSHA−224、SHA−384、SHA−512の総称です
                * SHA−256以上は電子政府推奨暗号です
### 認証技術
#### 認証の3要素
##### 記憶
###### ある情報を持っていることによる認証
例：パスワード、暗証番号など
##### 所持
###### あるものを持っていることによる認証
例：ICカード、電話番号、秘密鍵など
##### 生体
###### ある特徴を持っていることによる認証
例：指紋、虹彩、静脈など
##### 二要素認証
###### 左側の内2種類の組み合わせです
#### 認証の種類
##### 本人認証
###### 間違いなく本人であること
##### メッセージ認証
###### 改竄されていないこと
* ポイント
    * メッセージ認証を行う認証データの作成には、送信者と受信者画共有する認証鍵（MACシークレットなどともいう）を利用することが必要
    * IPsecやSSL／TLSなどで作成されるメッセージ認証データ（MAC：Message Authentication Code：メッセージ認証コード）を生成するには、RFC2104で規定されているHMAC（Hash-based Message Authentication Code）という方法が用いられる
##### 時刻認証
###### 「いつ」という時刻の痕跡を電子的に証明する
#### PKI：Public Key Infrastructure：公開鍵基盤
##### 公開鍵暗号方式を利用した社会基盤です．政府や信頼できる第三者機関の認証局（CA：Cerificate Authority）にディジタル証明書を発行してもらい、身分証明として使える
###### 自営でCAを構築で運用するもあり、このようなCAはプライベートCAと呼ばれる
* CAの公開鍵を自分でWebブラウザなどに登録作業が必要
###### 政府のPKIは一般とは区別し、政府認証基盤（GPKI）と呼ばれる
###### 機能より分類
* 登録局（RA：Registration Authority）
    * 電子証明書を発行してよいかの審査する機関
* 発行局（IA：Issuing Authority）
    * 電子証明書を実際に発行し管理する機関
* 検証局（VA：Validation Authority）
    * 電子証明書の有効性を検証する機関（CRLやOCSP対応）
##### ディジタル証明書
###### CAが申請した個人や団体の公開鍵をCAの秘密鍵で暗号（署名）したもの
* 申請流れ
    * 1．申請者が独自のキーペアを作成、秘密鍵を独自保管
    * 2．申請者 がCAに作った公開鍵証明書をて提出（CSR形式：サブジェクト、発行者、有効期間、シリアル番号など）
    * 3．CA側は申請者公開鍵証明書のハッシュ値を取得し、CAの秘密鍵を利用してディジタル署名する
    * 4．CAで署名済みの証明書を申請者に渡す、申請者のPKI認証済み公開鍵として利用する
* 認証流れ
    * 1．受け取った人、データの署名をローカルで計算して検証
    * 2．ローカルキャッシュしたCA公開鍵証明書を利用し署名証明書の正しさを確認
    * 3．CRLやOCSPを利用して証明書が失効されていないことを確認（OSCPは有料が多い）
        * CRL：Certificate Revocation  List：証明書失効リスト
            * 失効したディジタル証明書のシリアル番号のリストです
        * OCSP：Online Certificate Status  Procotol
            * HTTPを使ってXML構造でやり取りしている
###### 用途のより
* サーバ証明書
* クライアント証明書
#### ワンタイムパスワード
##### 盗聴されると何度でも不正利用される対策
###### 主な方式
* チャレンジレスポンス方式
    * 毎回異なる情報（チャレンジ）を送り、その情報にパスワードを加えて演算した結果（レスポンス）を返す方式、PPPのCHAR、APOPなどで利用されている
* セキュリティトークン
    * 認証をサポートする物理的なデバイスをセキュリティトークン、または単にトークンと呼ばれる
        * 認証サーバと時刻同期したワンタイムパスワードを表示して認証する
#### シングルサインオン（Single Sign-On：SSO）
##### 一度の認証で複数のサーバやアプリケーションを利用される仕組み
###### エージェント型（チケット型）
* SSOを構築するサーバそれぞれに、エージェントと呼ばれるソフトウェアをインストールする．ユーザは認証サーバで認証を受け、許可されるその証明にチケットを受取り．その後は各サーバーのエージェントでチケット確認の行う
    * 同一ドメイン内で、クッキーをチケットとして利用されることがある．ドメインまたがると、SAMLを用いてチケット情報を交換する
###### リーバスプロキシ型
* ユーザからの共有を一旦リバースプロキシサーバがすべて受けて、中継する方法．認証もリバースプロキシサーバで一元的に行い、アクセス制御を実施する
#### FIDO：Fast IDentity Onlineアライアンス
##### パスワードレス認証方式
###### FIDO UAF（Universal Authentication Framework）
* おもに生体認証を用いて実現
###### FIDO U2F（Universal Second Factor）
* パスワードともう一つの認証（所持認証あるいは生体認証）の組み合わせ
###### FIDO2
* デバイス側で指紋認証などの生体認証を用いて利用者を認証s必要、ログイン先のオンラインサービスと公開鍵暗号を使って認証を行う方式
    * デバイスに格納された秘密鍵は取り出されることがないので、フィッシング攻撃や中間者攻撃から利用者の認証情報を保護することができる
#### OAuth：Open Auth
##### Webサービスなどで、異なるサービス間で認可情報を委譲するためのプロトコル．
#### DNSSEC：DNS Security Extensions：RFC4034
##### 利用するためにクライアントとサーバ両方とも対応必要．
###### DNS応答レコードのドメイン登録情報にディジタル署名を付加している（RRSIGレコード）
###### DNSKEYレコード（ゾーンを署名する秘密鍵に対する公開鍵）として取得できる
###### 合わせて署名検証を実施し、DNSレコードの内容用の正当性を確認する
#### タイムスタンプ
##### ある事実が発生した日時の情報です、データに正確な日時情報をつけて保存することで、そのデータがその時刻に存在し（存在性）、その時刻の後に改竄されていないこと（完全性）が証明できる
###### PKIのディジタル署名は本人が改ざんした場合には検出できないので、TSA（時刻認証局）が提供している時刻認証サービスを利用して書類のハッシュ値に時刻を付加し、TSAがディジタル署名を行、これにより、たとえ本人が改ざんしてもその時刻が見える
* TSAの秘密鍵が必要ので、作成者独自で作成できないです
* タイムスタンプトークンは、電子文書のハッシュ値、TSAが付与した時刻情報、TSAのディジタル署名から構成される
#### ディジタルフォレンジックス：digital forensic
##### 法科学の一分野、不正アクセスや機密情報漏えいなどで法的な紛争が生じた際に、原因究明や捜査に必要なデータを収集・分析し、その法的な証拠性を明らかにする手段や技術の総称です
### アクセス制御技術
#### ファイアウォール
##### ネットワーク間に設置され、パケットを中継するか遮断するかを判断し、必要な通信のみを行えるようにするための機器
###### 予め設定されたACL（アクセス制御リスト：Access Control List）より制御する
* パケットフィルタリングライト型
    * IPパケット情報とポート番号を元にアクセス制御を行う
* アプリケーションゲートウェイ型
    * HTTP、SMTPなどのアプリケーションプログラムごとに細かく中継可否を設定できる
        * WAF：Web Application Firewall
            * 特化したFW、SQLインジェクションやクロスサイトスクリプティングなど、Webに特化した攻撃に対して、きめ細かくアクセス制御を行える
                * ブラックリスト方式
                    * ←通常WAFのベンダが提供し、適宜更新する
                * ホワイトリスト方式
                    * ←ユーザ独自に設定する
###### チェックできる範囲はIPヘッダ、TCPヘッダやアプリケーションヘッダなどの限られた情報しかないです
#### DMZ（非武装地帯：DeMilitarized Zone）
##### 完全に防御するでなく外部に公開する必要があるサーバはここに多く、インターネットと内部インターネットの間の中間ネットワークである
###### Webサーバ、メールサーバ、DNSサーバ、Proxyサーバなど
#### uRPF：Unicasat Reverse Path Forwarding
#####  ルータは、インタフェースに到達したパケットの送信元IPアドレスが到達可能かを確認する．到達不能なら破棄する．それで送信元IPアドレスを偽装したパケットの中継を防ぐ
###### 到達可能の確認はルーティングテーブルに存在する、かつルーティングパスは一致している
#### IDS（侵入検知システム：Intrusion Detection System）
##### ネットワークやホストをリアルタイムで監視し、侵入や攻撃など不正アクセスを検知したら管理者へ通知するシステム
###### NIDS：ネットワーク型IDS
* ネットワーク全体を監視、ホストに負荷がかからないが、暗号化されたパケットやファイルの改ざんなど、検知できない攻撃がある
###### HIDS：ホスト型IDS
* ファイルの改ざんなど、きめ細かい監視ができる、暗号化ファイルも復号して検査できる．ただ、全ての対象ホストに導入が必要とホストに負荷がかかる欠点がある
##### 単位時間当たりのパケットの量や、特定の攻撃パターンなど、さまざまなタイプの攻撃をチェックすることができる
###### シグネチャ型
* ウイルスの検出と同じように、不正侵入を行うような攻撃手法をデータベースに登録して検知で利用
###### アノマリ型
* 捕捉したIPパケットの内容を調べて、正常なもの以外は、全て異常であるとみなして警告を出す．未然にそれを検出ことができる（時間かかりし）
##### エラー
###### フォールスポジティブ
* 正常な通信であるにもかかわらず、それを不正侵入として誤検知してしまうエラー
###### フォールスネガティブ
* 本来検出すべき不正侵入を見過ごすエラー
#### IPS（侵入防御システム：Intrusion Prevention System）
### セキュリティ攻撃
#### ツール
##### ポートスキャンツール（ポートスキャナ）
##### 脆弱性検査ツール
###### 様々な侵入に用いられる攻撃手段によってシステムの安全性を試すためのツール
##### ルートキット（rootkit）
###### 攻撃者が攻撃対象者のコンピュータに侵入した後に用いるツールを集めたパッケージです．ログ改ざんツールなど侵入の発覚を防ぐものがある
#### IPスプーフィング：IP spoofing
##### IPアドレスを偽装して攻撃を行うこと
###### 偽装ので、TCPでのコネクション確立は不可能ので、UDP、ICMP、TCPのSYNパケットのみなど、相手との相互通信を成立させない方式で攻撃を行う
#### バッファオーバフロー攻撃
##### バッファの長さを超えるデータを送り込む、バッファの後ろにある領域を上書きし、動作不能または悪意コードを実行され
#### DoS攻撃：Denial of Service attack
##### サーバなどのネットワーク機器に大量のパケットを送るなどとしてサービスの提供を不能にする攻撃
###### DDoS攻撃：Distributed DoS attack
* 分散した複数の機器からパケットを大量に送る、一般的に踏み台（肉鸡）と呼ばれる複数のコンピュータから一斎に攻撃を行う
###### EDoS攻撃：Economic DoS attack
* 主にクラウドサービスに向け、攻撃対象に経済的な損失を与えることを目的とした攻撃
##### 主な攻撃手法
###### SYN Flood
* TCpのコネクション確立要求パケットであるSYNパケットだけを大量に送る攻撃
    * 受け取った相手のサーバ側はACK／SYNをを応答し、3ウェイハンドシェイクの成立のためのACKを待ちパケットを待ち、それで中途半端なコネクションが大量に残り、正常なサービスが受け付けられなくなった
###### ICMP Flood
* pingなどを利用して、ICMPパケットを大量に送出する攻撃、ping爆弾とも呼ばれる
###### DNSリフレクタ攻撃：DNS amp攻撃
* DNSでは、問合せの要求パケットよりも応答パケットの方がサイズが大きくなり性質があり
    * IP spoofingを組み合わせて、DNSの応答が攻撃対象のサーバに集中すること
###### NTPリフレクション
* NTPにはmonlistという、NTPサーバ状態を確認する機能があり、要求に対応する応答のパケットサイズが大きくなり性質があり
###### smurf
* pingなどで用いられるICMPエコー要求の応答パケットを攻撃対象に大量に送出する攻撃
    * 一つのIPアドレスで、そのネットワーク全体にブロードキャストパケットを用いて、ICMPエコー要求を送信する
###### Octopus攻撃
* 代理のTCPコネクションを確立することによって、攻撃対象のサーバに接続を維持させ続けてリソースを枯渇させる攻撃
###### マルチベクトル型DDoS
* 複数の攻撃手法を用いて、同時に連携して行う分散型のアクセス不能攻撃
    * サーバリソースを枯渇とネットワーク帯域を大量に消費、アプリケーション処理に過度に負荷をかけるなどの同時攻撃
###### SQLインジェクション
* アクセス情報を改ざんし、不正のsqLを投入することで、通常はアクセスできないデータにアクセスしたり更新したりする攻撃
    * 対策としては、制御文字を通常文字に置き換えるエスケープ処理やバインド機構を利用する方法がある
        * バインド機構
            * 入力データの部分を埋め込んで文字列を組み立てる際に、文字列の連結ではなくプリペアドステートメントという機能を利用してSQL分を組み立てる方法
                * 例：preparedStatement(“select name form tableA where id=?”)
この中「?」をプレースホルダーと呼び、？に制御もじを入力してもSQL分をコンパイルとき通常文字として処理され
###### クロスサイトスクリプティング（XSS）
* 悪意のあるスクリプトを標的サイトに埋め込む攻撃、クライアントに被害を起こす
    * 対策としては、スクリプトを実行させないように制御文字をエスケープ処理する
###### クロスサイトリクエストフォージェリ（CSRF）
* Webサイトにログイン中のユーザのスクリプトを操ルことで、サーバデータ等に被害を起こす ことでWebサイトに被害を与える攻撃
###### セッションハイジャック
* セッションIDやクッキーを盗むことで、になりすましてアクセスという不正アクセスの手口です
###### DNSキャッシュポイズニング攻撃
* DNSのキャッシュサーバに不正な情報を注入することで、不正なサイトへのアクセスを誘導する攻撃
    * 対策：キャッシュサーバとコンテンツサーバを分け、キャッシュサーバにはアクセスできるルートを制限する
###### SSL／TLSダウングレード攻撃／バージョンロールバック攻撃
* TLSハンドシェイクで提案された通信可能な複数のバージョンのうち最も弱いバージョンを指定することで、弱い暗号での通信を実現すること
###### サイドチャネル攻撃
* 対象装置の動作などを観察・測定することによって機密情報を取得しようとする攻撃です．ICチップなどのハードウェアに対する攻撃手法によく用いられる
    * タイミング攻撃
        * 処理時間を計測し、暗号の内容を推測したり、機密情報をとる方法（仮のランダムなど）
    * 電力解析攻撃
        * 消費電力を計測し、処理内容と消費電力の相関から機密情報を取る
    * 電磁波解析攻撃
        * 電磁波を測定し、秘密鍵を特定するなどの方法で、機密情報を得る方法
            * 漏えい電磁波を解読するテンペスト攻撃がある
##### 標的型攻撃
###### 特定の企業などを標的にした攻撃、金銭や知的財産などの不正取得を目的に、犯罪のプロによって行われることが多い攻撃です
* その内の一種に、「APT：Advanced Persisitent Threat：先進的で執拗な脅威」があり
* 攻撃ステップ
    * 1．攻撃準備
        * ターゲットの組織を攻撃するための情報を収集
    * 2．初期潜入
        * ターゲットに対して標的型攻撃メールなどを送付して、端末をウィルスに感染させ、侵入経路を作る
    * 3．攻撃基盤構築
        * 侵入したPCにバックドアを構築して外部サーバと通信を行い、新しいウィルとをダウンロードさせる
    * 4．システム調査
        * 目的情報の存在場所の特定や情報取得を行い、さらに、取得した情報を元に新たな攻撃を仕掛ける
    * 5．攻撃の最終目的の遂行
        * 最終目的となる情報を取得
* 標的型攻撃は、侵入後、バックアドレスを通いじて内部情報を取得する．そのため、システム環境の入口だけではなく、出口対策も必要です．
    * 外部対策：外部との通信を遮断数r、内部でのネットワーク設計を見直すなど
#### C＆Cサーバ：Command and Control
##### 不正プログラムに対して指示を出す、情報を受け取るためのサーバです．主に標的型攻撃を用いられる
###### バックドアを使用し、マルウェアに感染したPCなどを操作する．攻撃対象の組織に合わせたマルウェアのアップデートなども行い．
* 防ぐために、FQDNやIPアドレスを用いて、ファイアウォールやプロキシサーバなどでアクセス制限を行い
    * C＆Cサーバでは、このアクセス制限を避けるために、特定のドメインに対してDNSレコードを短期間に変化させるFast  Fluxや、ドメインワイルドカードを用いて、あらゆるホスト名に対して同一のIPアドレスを応答するDomain Fluxという方法を用いる
#### スマートデバイスのセキュリティ
##### 対策参照例
###### 1．OSをアップデートする
###### 2．改造行為を行わない
###### 3．信頼できる場所からアプリケーションをインストールする
###### 4．Android端末では、アプリケーションをインストールする前に、アクセス許可を確認する
###### 5．セキュリティソフトを導入する
###### 6．小さなPCと考え、PCと同様に管理する
##### BYOD：Bring Your Own Deviceはもっと複雑になり
##### MDM：Mobile Device Management
#### マルウェア
##### 悪意のあるソフトウェアの総称、不正や有害な動作を行う意図で作成されているソフトウェア全体を指す
###### ウイルス（コンピュータウィルス）
* 他のコンピュータに勝手に入り込んで有害な動作を行うソフトウェアです、ファイルの一部を書換えて自分のコピーを追加し、感染させることで自己増殖している
###### バックドア
* 無許可で利用するために、コンピュータ内に取り付けれラタ通信接続機能
###### キーロガー
* キー入力を監視し、それを記録するソフトウェア
###### トロイの木馬
* 入り込んで有害な動作を行うソフトウェアであり、自己増殖機能がない
###### スパイウェア
* ユーザに関する情報を収集し、それを情報収集者に自動的に送信するソフトウェアです
##### 攻撃形式
###### メール
###### ソフトウェア
###### ドライブ・バイ・ダウンロード攻撃
* 近年から、Webサイトを閲覧した際に、PC利用者の意図に拘らず、ウィルスなどの不正プログラムをPCにダウンロードさせる攻撃
    * 主に利用者のOSやアプリケーションなどの脆弱性が悪用されるので、最新版へアップデートが大切
##### 対策の考え
###### 1．ウィルス対策ソフトとウィルスリブは最新版を利用
* パターンマッチング
    * ウイルス定義ファイル（パターンのファイル）と呼ばれるファイルと比較することで検出
* ビヘイビア法
    * ウイルスと疑われる異常な通信をその挙動から検出する
        * 静的ヒューリスティック方法
            * プログラムを実行させるのではなく、コードを解析してウィルスかどうかを判定する
        * 動的ヒューリスティング方法
            * サンドボックスと呼ばれる保護された仮想環境の領域において実行するより判定する
* 逆アセンブル法
    * 検査対象を逆アセンブルし、ウイルス特有な制御命令などを抽出して検出
* インテグリティチェック法
    * ウイルスに感染していないことを保証する情報として、一般的にディジタル署名が用いられる
###### 2．メールの添付ファイルやダウンロードファイルはまずウィルス検査をする、不明な源のものは開かない
###### 3．最新のセキュリティパッチを適用
###### 4．データのバックアップをとっておく
###### 5．ウイルス対策ソフトがチェックしなくても、ウイルス感染が疑われる兆候を意識する
#### ダークネット
##### インターネット上で到達可能で、かつ未使用なIPアドレス空間です．
###### セキュリティ専門機関では、活動状況のためにダークネットに観測用センサを配備している
* マルウェアの傾向や探索活動wお見ることができる、DDoS攻撃の跳ね返りで、リフレクション攻撃などの痕跡なども確認できる
    * 例：送信元IPアドレスがA、送信ポート番号が80/tcpのSYN/ACKパケットを、未使用のIPアドレス空間であることを大量観測の場合、IPアドレスAをDoS攻撃をしているを推測できる
### その他
#### 電子透かし
##### 画像や音楽などのディジタルコンテンツに著作権者などの情報収集を埋め込み
#### ペネトレーションテスト
##### コンピュータやネットワークのセキュリティ上の弱点を発見するテスト手法の一つであり、システムを実際に攻撃して侵入を試みる
#### ソーシャルエンジニアリング
##### 巧みな話術や盗み聞き、盗み見などの手段によって、パスワードなどのセキュリティ情報重要な情報を入手する
## セキュリテイプロトコル
### TLS：Transport Layer Security
#### SSL3.0を元に考案された、TLS1.2が最新（2021）
##### TLSハンドシェイクプロトコル
###### →TCPコネクション：connect
* HTTP1.1まで、HTTP2からUDPを使うがある
###### ←Hello Request
###### →Client Hello
###### ←Server Hello
###### ←Server Certificate（＋証明書データ）
* クライアント側でこれをベースにサーバ認証を行う
* 証明書の有効性と証明書中のFQDNが一致かを検証
* 検証のため、CAの公開鍵がブラウザにインストールが必要
###### ←Server Key Exchange
* 証明書持っていない場合発生、一時的な鍵を生成
###### ←Certificate Request
* クライアント認証が必要な場合発生
###### →Client Certificate（＋証明書データ）
* サーバ側はこれをベースにクライアント認証を行う
###### →Client Key Exchange
* 暗号化に使用するセッション鍵を生成する際に必要となる情報を送付
    * プリマスタシークレット
###### →Certificate Verify
###### →Finished
###### ←FInished
###### ⇆暗号化通信
* 上のTLSハンドシェイクプロトコル終了後、暗号通信を開始
* キー交換で両側持っている共通鍵で暗号化（セッション鍵と呼ばれる）
    * 通信後に秘密鍵の安全性が破られたとしても、過去のセッション鍵の安全性が保たれるというFPS（Perfect Forward Secrecy）の性質が持って
    * キー交換は公開鍵暗号方式ではDHE（Ephemeral Diffie−Hellman）やECDHE（Ephemeral Elliptic Curve Diffe-Hellman）の利用が推奨されている
    * 共通鍵暗号はAESが推奨されている
##### サーバ証明書の種類
###### DV証明書：Domain Validation：ドメイン認証
* サーバの運営組織がサーバ証明書に記載されているドメインの利用権をもつことを確認できる証明書
    * 短期間かつ低コストで発行できる
    * 組織の実在性などは確認できない
###### OV証明書：Organization Validation：企業認証
* ドメイン名に加えて、サーバの運営組織の実在性を確認できる証明書
    * 料金と発行迄の時間はDVより長い
###### EV証明書：Extended Validation
* OVに加えて、サーバの運営組織の実在性について、国際的な認定標準に基づく審査が行われ、発行された証明書
    * 信頼性が一番高いが、発行コストも高い
    * EVサイトアクセスする場合、一部のブラウザのアドレス部分が緑色になり、運営組織が表示されることで、利用者はEV証明書であることを簡単に識別できる
##### 改ざん検知
###### パケットにハッシュ値を付加することによって改ざん検知ができる、ハッシュ値に秘密鍵を付加し、メッセージの認証を行うHMAC（Hash-based  Message Authentication Code）を利用する
#### トランザクション層のプロトコルのため、HTTPに限らず、SMTP、FTPなどTCPを用いるアプリケーションプロトコルはTLSを利用できる
#### SSL-VPN:Secure Socket Layer Virtual Private  network（TLS-VPNもあり）
##### TCP限定ので、UDPを使うプロトコル（RTP）などでは使えない欠点がある
###### それを対処するため、ソフトイーサネットなど、擬似的なLANカードを利用してVPNトンネルを作るSSL−VPNレイヤ2フォワード方式などの応用技術を利用する場合がある
###### また、ファイルウォールを通過できないアプリケーションのポート番号を、通過できるアプリケーションのポート番号に変換して通信を可能にするポートフォワード方式もある
##### 実現方式
###### リバースプロキシ
* URLのFQDNとしてSSLーVPN装置名を指定し、さらにそのパス名で内部サーバ名を指定するようにしている
    * この方法では、ユーザ独自のアプリケーションプロトコルnアドは利用できないという制約がある
###### ポートフォワード方式
* クライアントにVPNモジュールをダウンロードし、このVPNモジュールがTLSに対応していないアプリケーションなどのデータをTLS処理にリダイレクトする
###### L2フォワード方式
* データリンク層で、モジュール（仮想NIC）がアプリケーションのデータを受け取り、それをTLSのトンネルを使って SSLーVPN装置に転送する方式
#### SSL／TLSアクセラレータ
##### SSL／TLSの遅延の対処、SSL／TLS専用のハードウェアです
### IPSec：Security Architecture for  Internet Procotol
#### IPパケット単位での暗号化や認証、データの改ざん検出の機能を提供するプロトコル
##### 特徴
###### ネットワーク層のプロコトル、IPプロトコルを利用すれば、それ以上の任意プロトコルは使える
##### 通信流れ
###### IPSecでは、通信を行う時に仮想的な通信路であるSA（Security  Association）を生成し、その中で通信を行う
* SA：Security Association
    * ISAKMP SA／IKE SA：Internet Security Association and Key Management Procotol
        * 制御用SA、TLSハンドシェイクプロトコルと同様に、通信に先たち、データ交換を安全に行うために暗号化プロトコルや暗号鍵などの情報をやりとりする
    * IPsec SA
        * 通信データを送るためのSA、上がり用と下り用でそれぞれ別のSAを生成する、さらに、IPアドレスやポート番号、プロトコルが異なると別々のSAを生成する
    * 流れ、初めにIPsec通信を開始する機器をイニシエーターという、応答を返して通信路を確立する機器をレスポンダと呼ぶ
        * イニシエータ⇆レスポンダ
            * IKEでISKMP SAで接続確立
                * 1．パラメータ交換
                    * 暗号化アルゴリズム、認証アルゴリズムなどのパラメータを交換、2、3でやり取りする内容を決定する
                * 2．共通鍵の生成
                    * Diffie−Hellman鍵交換アルゴリズムで互いに乱数を交換することで、暗号化に使用する共有鍵を安全に生成する
                * 3．認証
                    * 通信相手のルータやPCなどの機器を認証する
                        * 方式は、事前共有鍵、ディジタル署名、公開鍵暗号などがある
            * 上がりと下りのIPSecSAをそれぞれ作成通信を行う、事前に折衝したIPsec通信に必要な共通鍵や暗号化アルゴリズムの他、始点IPや終点IPなどの情報を、送信側と受信側のVPN装置のSAD（Security  Association Database）というデータベースに登録し、管理される
* IKE：Internet Key Exchange  Procotol
    * 通信データを暗号化する用共通鍵を安全に交換するプロトコル
        * １．フェーズ1、ISAKMP SAを確立し、安全な通信に必要となる情報を交換する
            * 種類１：メインモード
                * 基本的なモードで、実装は必須．通信相手の認証はIPアドレスを基に行うので、イニシエータ、レスポンダの両方でIPアドレスが固定である必要
                    * IPsec対応ルータ同士の通信あなどによく用いられる
            * 種類２：アグレッシブモード
                * メインモードに較べて処理が簡略化されている、イニシエータのIPアドレスは固定でなくでも通信可能
                    * ルータとモバイルPC間の通信などによく用いられる
        * ２．フェーズ2、IPsecを確立し、安全な通信路を生成する
            * トランスポートモード
                * IPヘッダを付け加えられることはなく、オリジナルのIPヘッダとペイロードの間に、セキュリティプロトコル（ESPやAH）が入り
                    * ESP：Encapsulated Security  Payload
                        * データの暗号化認証をサポートしている
                        * パケットイメージ
                            * 新IPヘッダ
                            * ESPヘッダ
                            * オリジナルIPヘッダ
                            * IPペイロード
                            * ESPトレーラ
                            * ESP認証データ
                            * 暗号化範囲
                            * 認証範囲
                    * AH：Authentication Header
                        * データの認証を行い、暗号化はしない
                        * パケットイメージ
                            * 新IPヘッダ
                            * AHヘッダ
                            * オリジナルIPヘッダ
                            * IPペイロード
                            * 認証範囲
                * パケットイメージ
                    * オリジナルIPヘッダ
                    * AHまたは ESP
                    * IPペイロード
            * トンネルモード
                * 新しいIPヘッダが付け加える、このモードはIPsecゲートウェイでLAN内のIPアドレスを隠すする場合などに用いられる
                * パケットイメージ
                    * 新IPヘッダ
                    * AHまたはESP
                    * オリジナルIPヘッダ
                    * IPペイロード
* IPsecとNAT
    * IPsecではIPアドレスが認証範囲に含まれ、かつIPペイロードは全て暗号化されのため、NATは普通使えない（IP変わるとIPsecエラー発生、ポートが見えないでNAPT使えない）
        * NATトラバーサルなどの技術が必要
            * 例：ESPパケットをUDPでカプセル化する
* 他のプロトコルとの組み合わせ
    * レイヤ2の　L2TP（Layer 2 Tunneling  Procotol）やPPTP（Point-to-Point Tunneling Procotol）
        * NAPT環境においてVPNパケットを通過させる機能のこと、特にPPTPパケットを対象にした場合には、PPTPパススルー機能が持っておりルータがある
    * レイヤ3のGRE（Deneric Routing  Encapsulation）
        * IPsecでの弱点はIPアドレスの宛先が一つであるユニキャスト通信しかできない
        * マルチキャスト通信を行うOSPFパケットをカプセル化することはできない
        * GREは、マルチキャスト通信などを行うIPパケットをカプセル化できる
        * 概要
            * IPsecでは暗号機能、GREはOSPFマルチキャストためのIPパケットカプセル化の組合せ
    * レイヤ4のSSL−VPN（TLS−VPN）
##### IPv6ではIPv6拡張ヘッダの中にIPsecの機能が含まれている
##### VPN（Virtual Private Network）を構築する時に用いられる代表的な技術
##### IPsec接続の端は一般的に社内PCまでではなく、L2SWまでです．
### IEEE 802.1X
#### 認証を行うプロトコルです、無線LAN、有線LANに拘らずポートごとに認証を行い、認証に成功した端末だけがLANに接続できる
##### RADIUS：Remote Authentication Dial In User Service
###### 認証と利用事実の記録（アカウンティング）を一つのサーバで一元管理する仕組み
* 元々はダイヤルアップ接続のためのプロトコル、IEEE 802.1Xでの活用され
###### クライアントサーバで動作する
##### 構成
###### 
* サプリカント：Supplicant
    * IEEE 802．1Xでアクセスする端末に含まれるソフトウェアであり、オーセンティケータとの間で認証情報をやりとりする
* オーセンティケータ：Authenticate
    * 無線LANアクセスポイントや認証スイッチなど、IEEE802．1Xの機能を実装したブリッジです．イメージではRADIUのクライアントとなっている．
        * サプリカントから受け取った認証情報に基に、認証の可否を認証サーバに問い合わせ
* 認証サーバ
    * 認証情報を保存しているサーバ、ここで認証に成功したら、オーセンティケータはスイッチのポート利用を許可する
* EPA：Extensible Authentication Procotol：拡張認証プロトコル
    * PPPを拡張した認証プロトコル、EAPでは様々な方式を利用でき、認証方式によって、クライアント認証、サーバ認証のそれぞれの認証方式を決定する
        * 代表的な認証方式
            * EAP-MD5
                * クライアント認証にユーザ名とパスワードを使い、パスワードは平文で送るのではなく、CHAPと同様にハッシュ関数を利用する．サーバ認証は行わない
                    * CHAP：Challenge-Handshake Authentication Procotol
            * EAP-PEAP：Protected EAP
                * サーバ認証はサーバから送られてきたサーバのディジタル証明書が正当なものかどうかを検証する
                    * その後、ディジタル証明書の公開鍵を使ってクライアントとサーバ間に暗号化された通信路を作り、そこでユーザ名とパスワードやキートークンなどの認証情報をやりとりする
            * EAP−TLS
                * サーバ認証はサーバのディジタル証明書、クライアント認証はクライアントのディジタル証明書を検証することで相互認証を行う
            * EAP−TTLS：Tunneled TLS
                * PEAPと類似で、暗号化通信路はTLSで構築
    * EPAOL：EAP Over Lan
        * IEEE802．1Xでは、サプリカントと認証サーバの間でEAPパケットをやりとりしている．オーセンティケータでは、EAPOLで受け取った EAP情報をRADIUパケットに乗せ替えて転送する
        * 途中のサプリカントとオーセンティケータの間でイーサネットを使用している場合には、EAPパケットをEthernetフレームのデータ部分に入れてやり取りする．このプロトコルはEPAOLです
* VLANとの関係
    * IEEE 802．1Xでは、認証の成功・失敗を判断する以外、認証状況（成功／失敗）によって、割り当てるVLANをポートごとに決めることができる
        * ウイルス対策が施されていないPCを隔離する検疫ネットなど、このようなVLANによるIEEE 802.1X認証方式を利用している
### 無線LANセキュリティ
#### WEP：Wired Equivalent Privacy：有線同等機密
##### 無線LANアクセスポイントごとに設定されるネットワーク識別子であるSSID（Service Set Identifier）ごとに暗号化鍵（WEPキー）を予め設定している
###### アルゴリズムはRC4を利用している※ストリーム暗号化
* 鍵の長さは40ビットまたは104ビットであり、これを毎回変更されるランダム値である24ビットのIV（Initialization Vector）を追加し、64ビットまたは128ビットとしている
##### 脆弱性あり、現在は推奨されていない
#### WPA：Wi-Fi Protected Access（WAP、WAP2、WAP3）
##### 無線LAN製品の普及を図る業界団体であるWi-Fi  AllianceがWEPの脆弱性対策として策定した認証プロトコル
###### Enterprise WAP
* 企業用、IEEE 802．1X認証サーバを利用する
###### Personal WAP
* PSK（Pre−Shared Key：事前共有鍵）モードを使い、アクセスするすべてのコンピュータに同じ共有鍵を設定する
##### IVは48ビットになり、TKIP（Temporal Key Integrity Procotol）を利用して、システム運用中に同的に鍵を変更できる
##### WAP2では、暗号ベースのAES-CCMP（AES  Counter−mode with CBC-MAC Protocol）を利用している
##### WPA3では、暗号強度を192ビットに上げて、様々な改善をしている
#### アクセスポイントのセキュリティ
##### MACアドレスフィルタリング
###### 登録されて以外アクセス禁止
##### SSID隠す
##### プライバシセパレータ（アクセスポイントアイソレーション）
###### 同じアクセスポイントに接続されている機器同士の通信を禁止する機能、公衆無線LANサービスや宿泊施設などの無線lANサービスなどでよく利用されている
### その他のセキュリティプロトコル
#### SAML：Security Assertion Markup  Language
##### インターネット上でユーザやパスワードなどの情報をやり取りするためのXML仕様
###### SSOを実現するときの通信でよく利用されている（クッキーが利用できないとSAMLが利用する）
#### S／MIME：Secure MIME
##### MIME形式の電子メールを暗号化し、ディジタル署名を行う標準規格．認証局で正当性が確認できた公開鍵を用いる
###### ハイブリッド方式：共通鍵でメール本文を暗号化する、受信者の公開鍵でその共通鍵を暗号化してメールに添付する
###### ディジタル署名を添付することで、データの真正性と完全性も確認できる
#### PGP：Pretty Good Privacy
##### S／MIMEと同様にの、電子メールの暗号方式です．認証局はなく、「信頼の輪」の理念に基づいて、自分の友人が信頼している人の公開鍵を信頼するという形式を撮ることです、小規模なコミュニティに向き
