# ＮＷ：０６_ネットワーク設計
## 概要
### 考慮ポイント
#### 1．現状のユーザ数や使用するデータ量
#### 2．新たにネットワークに求めるもの
#### 3．求められている性能要件
#### 4．可用性、障害の起こりにくさなどの信頼性要件
#### 5．必要なセキュリティ
#### 6．新なネットワークにかけることが可能なコスト
### 論理設計
#### 器用の業務や組織などを中心に、ネットワークの最適な内容を考え．
#### 論理回線
##### １本の物理回線を、時分割多重や周波数多重、VLANなど様々な方法で論理的に複数に分け破れたそれぞれの回線
###### 一つの物理回線で最大いくつの論理回線を使用できるということを、論理回線の多重度と言い
##### 複数の物理回線を１本の論理回線にすることも可能
###### 利用例
* チーミング：Teaming
    * コンピュータに複数のネットワークカードを取り付け、すべての帯域幅を束ねて利用する技術である。
* リンクアグリゲーション（Link Aggregation）
    * ルーターやスイッチ、NAS間に接続された複数のLANケーブルを1つの論理リンクとして構成する機能です
### 物理設計
#### 実際のハードウェア、機器を基準に、現在の機器での適切なネットワークを設定する
## 電話、電源設備
### 電話
#### IP電話が主流となった現在で、必要なハードウェア量を見積もりもる必要
##### 呼量（アーラン：erlang）
###### 呼：電話をかけてから切るまでの１回の通話のこと
###### 呼量：ある瞬間二いくつの呼が接続中かを表す単位で、全ての呼の利用時間を単位時間で割ったもの
* 計算式
    * １時間に３回線のそれぞれに電話を30分掛かってきた場合．全ての呼の利用時間は30分✖️3＝90分．単位時間は１時間＝60分
        * 30分✖️3➗60分＝1.5アーラン
##### 呼損率
###### 呼が発生した時に通話中で繋がらないという呼損が起こる確率、呼量より計算している
* B：呼損率、a：呼量、n：回線数（本）
    * 計算は大変ので、一般的に予め計算結果をまとめた呼損率表を利用して計算する
### 電源設備
#### ネットワークシステムやサーバなどのトラブルには、電源に関連したことで起こる物が多くある
##### UPS：Uninterruptible Power Supply：無停電電源装置
###### 発電機を併用することで、より長期間電力断を対応できる
## 信頼性設計
### 代表的な設計手法
#### フォールトトレランス
##### システムの一部で障害が起こっても全体でカバーして機能停止を防ぐ
###### 冗長化など
#### フォールトアボイダンス
##### 個々の機器の障害自体が起こる確立を下げて、全体として信頼性を上げる
#### フォールセーフ
##### 障害が発生した時、安全側に制御する方法
###### 例：信号が故障した時にはとりあえず赤を点灯するなど、障害が新たな障害を産まないように制御し、処理を停止させること
#### フェールソフト
##### 障害が発生した時、障害が怒った部分を切り離し、最低限のシステムの稼働を続ける
###### 機能を限定的にして稼働を続けることをフォールバック（縮退運転）と言い
#### フォールとマスキング
##### 機器などに故障が発生した時、その影響が外部に出ないようにする方法
###### 冗長化などフォールトトレランスと似た感じ
#### フールプルーフ
##### 利用者が間違った操作しても危険な状況にならないようにするか、そもそも間違った操作ができないようにする設計手法
###### 操作制御や操作上アラートを出すなど手法がある
### システムの冗長化
#### デュアルシステム
##### 二つ以上のシステムを用意し、並列して同じ処理を走らせて結果を比較する方式．結果を比較することで高い信頼性を得られ、また、一つのシステムに障害が発生しても他のシステムで処理を継続することが可能
#### デュプレックスシステム
##### 二つ以上のシステムを用意し、Active−Standby（主系／従系、現用系／待機系）方式
###### ホットスタンバイ
* 従系のシステムを常に稼働可能な状態で待機
    * フェールオーば：故障が起こった時に自動的に従系に切り替えて処理を継続する
###### ウォームスタンバイ
* 従系は本番と同じような状態で用意しているが、すぐに稼働はできない状態で待機している
    * 切り替えの時、サーバの立ち上がって、アプリを稼働させてなど切り替え時間が少しかかる
###### コールドスタンバイ
* 従系は、機器の用意だけ
    * 切り替えの時、電源入れて稼働させ、各資材の配置する．切り替えに最も時間がかかる
### RASIS
#### コンピュータシステムの信頼性を評価するための要素をまとめたもの
##### Reliablity：信頼性
###### 故障や障害の発生のしにくさ、安定性を表す．指標にMTBFやその逆数の故障率がある
##### Availability：可用性
###### 稼働している割合の多さを表す．指標には稼働率がある
##### Serviceability：保守性
###### 障害時のメンテナンスのしやすさ、復旧の速さを表す．指標にはMTTRがある
##### Integrity：保全性・完全性
###### 障害時や過負荷時におけるデータの書替えや不整合、消失の起こりにくさを表す．一貫性を確保する能力
##### Security：機密性
###### 情報漏えいや不正侵入などの起こりにくさを表す
### QoS：Quality of Service
#### 一般的にはサービスがどれだけユーザのニーズ似合っているか、要求や品質を満足させられるかを表す尺度です
#### ネットワーク分野では、ルータやレイヤ3スイッチなどに実装される技術で、優先制御や帯域制御などのトラフィック制御を行う
##### 優先制御
###### フレームの種類や宛先に応じて優先度を変えて中継する制御方式．IPヘッダのTOSやDSCPなどのフィールドが多く用いられる
##### アドミッション制御：Admission制御
###### 通信を開始する前に、ネットワーク帯域などのリソースを要求し、確保の状況に応じて通信を制御する方法
##### シェーピング：Shaping
###### パケットの送出間隔を調整し、最大速度を超過しないトラフィックを平準化する方法
##### ポリシング：Policing
###### トラフィックが最大速度を超過しないか確認し、超過した場合は破棄するか優先度を下げるかして通信を行う
## 負荷分散：Load balancing：ロードバランシング
### 処理の負荷を多数のコンピュータやプロセスに分散し、リソースの利用効率を高め、性能を向上させる方法
#### メリット
##### スケーラビリティ（拡張性）を向上できる
###### 新たなリソースを増やすは簡単になるため
##### アベイラビリティ（可用性）を向上できる
###### 複数があり、故障が起きた場合でも他の装置で代替できる
#### 方法
##### DNS
###### 一つのホスト名に複数のIPアドレスを割り当て、問い合わせごとの順番に、異なるIPアドレスを返答する
* セッション切れので、利用上要注意
##### 負荷分散装置（ロードバランサ）
###### ヘルスチェック
* 障害が起こっているサーバにパケットを振り分けないための機能
###### Webサーバなどの通常のサーバだけに限らず、ファイアウォールやIDSなどのネットワーク機器でも負荷分散を行なっている
###### マルチホーミング
* 複数のルータからISPを経由して、インターネットに接続するネットワークを分散させることもある
#### 負荷分散方式
##### ラウンドラビン
###### 要求ごとに順番にサーバにセッションを振り分けていく（重みつけラウンドロビンもある）
##### リーストコネクション
###### 接続コネクション数を基に、接続が少ないサーバに振り分ける方式（重み付けリーストコネクションもある）
##### ファーストアンサ
###### 最も応答の早いサーバに接続する方式
##### ハッシュ　
###### 送信もとIPなどアドレスのハッシュ値を基にサーバを選択する
#### セッション維持機能（セッション・パーシステンス）
##### 一つのセッションを継続して特定のサーバに振り分ける機能、セッションの途中で別のサーバに振り分けられて処理が中断するトラブルを防ぎる
###### IPやポート番号を利用する
###### クッキーを利用する
* この場合、SSL／TLSを復号化が必要です．一部負荷分散装置には、SSL／TLSの暗号や復号を行う機能が持つもあり
## 通信技術や計算
### 符号化・データ伝送技術
#### 誤り検出・訂正
##### 代表的な手法
###### パリティ（奇数パリティ、偶数パリティ）
* 1ビット誤り検出
###### 垂直パリティ＋水平パリティ
* 1ビット誤り訂正＋1ビット誤り検出
###### ハミング符号
* 1ビット誤り訂正＋2ビット誤り検出
###### CRC：Cyclic Redundancy Check：巡回冗長検査
* nビット誤り検出
    * 連続する誤りを検出するための誤り制御の仕組み
        * 送信する元となるデータを、予め決めた生成多項式と呼ばれる式で割り算を行い、その余をCRCとする
    * 通信パケットでのエラーは、一度に多くのエラーが起こるバースト誤りが多く特性と合っている
### 通信に関する計算
#### ビット／バイト換算
##### 通信で伝送されるデータ量は、通常バイト単位で記述sあれ、それに対して、通信速度を表す時には、通常ビット単位で記述され
#### 伝送効率
##### 通信ヘッダ、制御通信など通信データ以外のオーバヘッドが存在ので、実際には通信速度の100％でデータを送るはできない
###### 通信速度に対してどれくらいの速度でデータを送られるかという割合が伝送効率です
#### 通信速度
##### 伝送時間［秒］＝データ量［バイト］X８／（通信速度［ビット／秒］X伝送効率）
#### 標本化定理
##### ある周波数のアナログ信号をディジタルデータに変換するとき、それをアナログ信号に復元するためには、その周波数の２倍のサンプリング周波数が必要だという定理
#### 注意点
##### 1．単位を注意
##### 2．有効数字、切り上げ、切り捨てを確認する
## トラフィックに関する理論
### 代表的なもの
#### 呼損率
### 待ち行列理論
#### ある列に並ぶときに、平均でどれだけ待たされてたを統計学的な計算です
##### 三要素
###### 到着率
* どれくらいの頻度でやってくるか
###### サービス時間
* 実作業にどれくらい時間がかかるか
###### 窓口の数
* 一つの列に対して窓口がいくつあるか
##### モジュール
###### M／M／1
* 到着率が一定ではなくランダム（M）（ポアソン分布）、サービス時間が一定ではなくランダム（M）（指数分布）、窓口は一つのみのモジュール
* 計算式
    * 利用率ρ＝仕事をしている時間（量）／全体の時間（量）＝平均サービス時間／平均到着間隔
    * 平均待ち時間＝ρ／（1 ー ρ）　X  平均サービス時間
    * 平均応答時間＝平均待ち時間＋平均サービス時間
#### 負荷分散の待ち時間計算
