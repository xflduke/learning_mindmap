# ＥＳ：０６_要件定義とシステム設計
## 要件定義
### V字モデル：商品戦略→要求定義→システム設計→ソフトウェア設計→プログラミング→モジュールテスト→システム設計テスト→商品テスト→経営評価
### 要件定義
#### システム設計に入る際に要求内容を体系的に分析し、設計に着手できるように整理を行う
##### 主な検討項目
###### 外部インタフェース仕様
###### ヒューマンインタフェース仕様
###### 性能条件
###### 信頼性及び安全性
###### 関連技術、要素技術の動向調査
#### 参照：要求工学：Requirements Engineering
##### ソフトウェア開発において、要求仕様を決定するプロセスを工学的に定式化する技術である
#### フィジビリティスタディ（実現可能性調査：feasibility study）
##### 要件定義の段階では、設計作業に入る前に、要求仕様が利用可能なリソースである開発期間内実現可能であるかについて事前検討
#### 機能要件と非機能要件
##### 機能要件
###### システムの外部仕様として求められている機能に関する仕様である。ユーザの要求に直接応える仕様をいう
##### 非機能要件
###### ユーザの要求に直接は対応しない仕様及び制約事項をいう
#### リアルタイム性
##### 必要な処理を必要な時間内に終わらせる特性
### トレードオフ問題
#### 実現：ハードウェアとソフトウェア
##### ハードウェアで実現する場合
###### メ
* 主に高速化
###### デ
* コスト、消費電力、部品実装とメンテなど
##### ソフトウェアで実現する場合
###### コスト的なメリットがあるが、要検討事柄→
* 実現可能性、機能面、性能面での検討
* ソフトウェア所在環境の他の処理への影響
* ソフトウェア開発とメンテコスト（期間も含む）
#### ハードウェアトレードオフ
##### QCDの検討、例
###### 誤り訂正機能と効率やコスト
###### 消費電力と動作速度性能
* CMOS論理回路では、同じの動作を行う場合の消費電力は動作周波数にほぼ比例する
#### ソフトウェアトレードオフ
##### 参照：JIS X 25010：2013
###### ソフトウェア品質特性
* 品質特性
    * 機能適合性
        * 品質副特性
* 機能適合性：Functional Suitability
    * 明示された状況下で使用する時、明示的ニーズ及び暗黙のニーズを満足させる機能を、製品またはシステムが提供する度合い
        * 機能完全性
        * 機能正確性
        * 機能適切性
* 性能効率性：Performance Efficiency
    * 明記された状態（条件）で使用する資源の量に関係する性能の度合い
        * 時間効率性
        * 資源効率性
        * 容量満足性
* 互換性：Compatibility
    * ハードウェア／ソフトウェア製品の他のモノとの交換することができる度合い
        * 共存性
        * 相互運用性
* 使用性：Usability
    * 明示された利用状況において、有効性、効率性及び満足性を持つて明示された目標を達成するために、明示された利用者が製品またはシステムを利用することができる度合い
        * 適切度認識性
        * 習得性
        * 運用操作性
        * ユーザエラー防止性
        * ユーザインターフェース快美性
        * アクセシビリティ
* 信頼性：Reliability
    * 明示された時間帯で、明示された条件下に、システム、製品または構成要素が明示された機能を実行する度合い
        * 成熟性
        * 可用性
        * 障害許容性（耐故障性）
        * 回復性
* セキュリティ：Security
    * 人間または他の製品もしくはシステムが、認められた権限の種類及び水準に応じたデータアクセスの度合いを持てるように、製品またはシステムが情報及びデータを保護する度合い
        * 機密性
        * インテグリティ
        * 否認防止性
        * 責任追跡性
        * 真正性
* 保守性：Maintainability
    * 意図した保守者によって、製品またはシステムが修正することができる有効性及び効率の度合い
        * モジュール性
        * 再利用性
        * 解析性
        * 修正性
        * 試験性
* 移植性：Portability
    * 一つのハードウェア、ソフトウェアまたは他の運用環境若しくは利用環境からその他の環境に、システム、製品または構成要素を移すことができる有効性及び効率性の度合い
        * 適応性
        * 設置性
        * 置換性
### 用量見積もり
#### 処理速度
##### CPU処理時間の計算
###### 通常はMIPS（Million Instructions Per Second）値で表す
* 処理時間（秒）＝処理に必要な命令の数／（MIPS値✖️1000000）
##### 通信時間の計算
###### 伝送時間＝データ量／（回線速度✖️伝送効率）
* 伝送効率の影響要素：スタートビット、ストップビット、CRCなど実データ以外ものや伝送あやまりでの再送
#### 音声データの量の計算
##### １秒当たりのデータ量＝（１サンプル当たりのビット数）✖️（サンプリング周波数）✖️（チャネル数）
###### チャネル参照：モノラル（monaural）音声の場合は１、ステレオ（stereo）音声の場合は2
###### 参照
* 電話品質の音声データ
    * １秒当たりのデータ量＝8✖️8kHz✖️1＝64000bps＝8000バイト／秒
* オーディオ品質の音声データ
    * CDの記録形式は、非圧縮のPCM（Pulse Code Modulation）形式であり
        * １秒当たりのデータ量＝16✖️44.1kHz✖️2＝1411200bps＝17.64MB/s
* 圧縮音声データ
    * 人間の聴覚心理特性を利用してオーディオ品質の音声を圧縮技術が、携帯用オーディオプレーヤなどで利用されている。（オリジナルデータの1/10程度に圧縮しても人間は両者の音質的な差にきづきにくいといわれている）
        * 圧縮ごのビットレートが128kbpsである時の圧縮率
            * 圧縮後のデータサイズ／オリジナルデータサイズ＝
128kbps／1411200bps≒0.09倍
#### 画像データ量の計算
##### RGB形式
###### Red、Greenn、Blueそれぞれのデータを持つ、24ビットカラーの場合、1,677万色になる
##### YUV形式
###### 輝度（Y）情報は各ピクセルについてもつが、色差情報（U及びV）は2ピクセルに対して2倍とを使用し、隣り合う2ピクセルをまとめて同一の色情報を割り当てる
* →輝度情報と合わせて1ピクセル当たり2倍とのデータ量となり、RGBよりも少なくなっている
    * テレビ放送で用いられている表現形式であり、白黒放送とカラー放送の互換性を考慮する必要から考案された
##### 静止画像データ
###### １枚当たりのデータ量＝（1ピクセル当たりのビット数）✖️横方向のピクセル数✖️縦方向のピクセル数
* 黒白：1ビット、16色：4ビット、256色：8ビット
##### 動画データ
###### １秒当たりのデータ量＝１枚当たりのデータ量✖️１秒当たりのフレーム数
* テレビ放送の非圧縮YUVの場合
    * １秒当たりのデータ量＝（1920✖️1080✖️16）✖️30＝995,328,000ビット≒124Mbps
    * １秒当たりのデータ量＝（640✖️480✖️16）✖️30＝147,456,000ビット≒140Mbps≒18Mbps
* DVDのMPEG−2形式では概ね4Mbps程度に圧縮されている、480pより圧縮率は1／35程度となっている
### データの圧縮方式
#### 文書データの圧縮方式
##### エントロピー符号化：データの出現確率に応じて長さの異なる符号を割り当てることで圧縮する方式である。出現確率の高いデータには短い符号を割り当て、出現確率の低いデータには長い符号を割り当てることで、データ1個当たりの平均のビット長を抑え、データ全体での冗長性を低くする子で圧縮を行う
###### 例：ハフマン符号、LZ77符号、LZ78符号、適応型ハフマン符号など
#### 音声データの圧縮方式
##### 非可逆圧縮（ロッシー）が一般
###### µ−law、A−law
* サンプリングされた音声データのそれぞれに対して対数圧縮を行う圧縮方法で、電話回線ネットワークでの音声データの圧縮にひろくつかわれている。
###### ADPCM：Adaptive Differential PCM：適応差分PCM
* 隣接するサンプル間での差分を符号化する圧縮方法である
    * 多くの場合隣接するサンプルの間で極端な変化がないことに着目して考案された方法、圧縮・展開とも連結するサンプルデータとの差分演算のみで行えるため、演算量は少なくで済む
        * PHSでの音声圧縮に用いられる
###### MP3（MPEG Audio Layer−3）、AAC（Advanced Aduio Coding）
* 音声データを短い時間区分に分けた後、周波数成分に分解し、人間が認識しにくい部分の成分をを間引くことによって圧縮を行う方式である。
    * 圧縮・展開には周波数成分への分解や合成処理が必要
###### CELP：Code Excited Linear Prediction
* 携帯電話向けに開発された音声圧縮技術。人間の音声で特徴的な波形のパターンをあらかじめ多数用意し、入力された音声と類似しているパターンをその中から選び、符号として送信する
    * 特化しているため、楽曲などの信号圧縮に向かない
#### 画像データの圧縮方式（静止画）
##### 非可逆
###### JPEG
* 画像を縦横8画素の区画に分け、それぞれの区画で2次元DCT変換を行い、人間が認識しにくい部分の成分をカットした後、ハフマン符号によるエントロピー圧縮を行う
###### JPEG2000
* JPEGのDCT変換に変わり、ウェーブレット変換が用いられている、JPEGよりも圧縮率を高めても画像の破綻が少ないとされている。ただ、圧縮・展開にかかる演算量はJPEGよりも多い
##### 可逆
###### MH、MR、MMR
* ファクシミリ画像通信で用いられる白黒のような2値画像を圧縮するための画像圧縮規格
    * 連続データを数の情報に置き換える
###### GIF
* LZWを使用した可逆圧縮方式の画像形式である
    * 取り扱える色の数は256色以下の制限がある。自然画像の圧縮に向かないが、使われる色数が少ないほど、または特定の色が多数の画素で使われるほど圧縮効率が高くなるため、Webページのボタンなどに使われている
###### PNG
* ビットマップ画像を扱うファイルフォーマットである。圧縮アルゴリズムとしてDeflateを採用している、圧縮による画質の劣化のない可逆圧縮の画像ファイルフォーマットである
#### 画像データの圧縮方式（動画）
##### 非可逆
###### Motion JPEG
* JPEG画像を時系列に羅列して動画記録とする方式。各フレームが完全な画像情報を持つ
###### MPEG−1ビデオ
* 主にビデオCDで利用されている圧縮方式であり、ビットレートは1.5Mbps程度、圧縮にはフレーム間予測技術が用いられる
###### MPEG−2ビデオ
* DVDの動画記録やデジタル放送で採用されている圧縮方式、フレーム間予測技術が用いられる
    * Iフレーム（Intra−coded Frame）
        * 画像全体の情報を持つ、0.5秒に１回当たり記録
        * IFrameから次のIFrameまでに含まれる画像群をGOP（Group Of Picture）という。画像の記録は、このGOP単位で行われる
    * Pフレーム（Predicted Frame）
        * 直前の画像との差分情報のみを持つフレーム
    * Bフレーム（Bi−directional Predicted Frame）
        * 直前直後両方の画像との差分情報を持つフレーム
    * 
###### H.264
* MPEG−2よりも符号化効率を上げた動画圧縮技術。圧縮アルゴリズの基本的な考え方はMPEG−2と同じであるが、画像ごとの特徴に適応的に対応することで、MPEG−2の約2倍の圧縮効率が得られと言われている
## システム設計
### 最適化設計
#### リソース活用の全体最適
##### CPU演算能力、メモリ、ハードディスクなどのストレージ、システムバスの帯域、通信回線の速度など各種リソース総合的に最適化利用
###### 例：通信帯域が圧迫、CPUが余裕ある場合、圧縮等手法でCPU資源を使って通信データ量を減らす
#### 通信性能の最適化
##### 割込みのオーバヘッド
###### バッファを利用で割込み回数を減らす
* FIFOメモリ
    * あらかじめ設定されたデータ数に受信されたデータ数が達した時や送信バッファが空になった時割込みを発生させる機能がある
#### 性能評価
##### 手法
###### 解析的な方法
* 待ち行列などを用いてシステムをモデル化し、性能データを得るやり方
    * 計算量は比較的少なく、高精度の解が得られる
        * 計算モデルの正確さや計算精度には注意要
###### シミュレーション
* 解析的に解が求められないモデルに対しても数値的に解が得られる
* また、解析的な方法の検証用の用いられる
### 省電力設計
#### 消費電力の見積もり
##### スペック調査回路シミュレータで
#### 突入電流
##### 機器によっては電源投入時に定常によりもはるかに大きい電流が短時間流れる場合がある
###### 主な要因としてはモータや内部のコンデンサなどがある
###### 突入電流の影響により、電源のヒューズが切れたり、接続されている他の機器に対して一時的な電圧降下をもたらしたり、場合によっては他の機器に瞬断を発生させたりすることがある
* 場合によっては定常的な電流の100倍を超えることもある
#### 電源制御
##### 必要な分のみを使う
###### クロックゲーティング
* 動作する必要のないブロックに供給しているクロックを停止することで消費電力を減らす方法っである
    * CPUなどの論理回路では、消費電力は動作クロック周波数にほぼ比例するため、クロックを停止することで回路の消費電力を極めて小さく抑えることができる。クロック停止中でもレジスタの値など回路の内部状態は保持される
        * クロック停止中に流れるわずかな電流をリーク電流という
    * 復帰時に発振安定待ち時間がかかる
###### パワーゲーティング
* 電源供給の制御を機能ブロックごとに行う方法である
    * リーク電流がないで、更に電力消費を減らせる。機能特性によって、電源を投入してから使用可能になるまでの復帰時間が長い要する場合がある
        * 復帰時間：発振の安定、通信プロコトル確率などがある
###### 動作周波数制御
* CPUなどの論理回路の動作周波数を変更することで消費電力を制御する方法である
    * CPUなどの論理回路では、消費電力は動作クロック周波数にほぼ比例する
    * 変更しようとしているクロックがハードウェアタイマのクロック源として使われているときには、同時にタイマの分周設定も必要に応じて設定し直す必要があることを注意必要
###### CPU休止命令による制御
* CPUを動作させる処理がない時には休止命令を実行することで電力消費を抑えることができる
    * 休止モードからの復帰には、割込みが利用される
### セキュリティ設計
#### 著作権保護技術：DRM：Digital Rights Management
##### 著作権保護の観点からコピー回数や方法などに制限を設けるための仕組み
###### 例
* SCMS：Serial Copy Management System
    * 民生用オーディオ機器で用いられている著作権保護技術。コピー条件は指定可能（何度でも、１度のみ、不可）
* CSS：Content Scrambling System／CPRM：Content Protection for Recordable Media
    * DVDなどの記録メディアなどで用いられている
* DTCP：Digital Transmission Content Protection
    * 映像データなどをディジタル伝送するための暗号化技術
#### リバースエンジニアリングと耐タンパ性
##### コンピュータシステムの内部構造の解析のしにくさ、見破られにくさのことである。
###### ハードウェア
* 信号の読み出し用プローブの取り付けを検出するとICチープ内の保存情報を消去する回路を設ける
###### ソフトウェア
* プログラムとデータの暗号化
#### サイドチャネル攻撃
##### 機器本来の情報入出力手段以外の経路から入手右下情報を用いて秘密情報の取得を試みこと
###### 例
* 装置が発する電磁波、消費電力、処理時間の測定することで暗号の解読を試みすること
#### 電磁波盗聴：テンペスト（TEMPEST）：Transient Electromagnetic Pulse Surveillance Technology
##### 漏洩電磁波などの微弱な電波から情報を盗む技術
### 安全性設計
#### 電磁両立性：EMC：Electromagnetic Compatiblity
##### 電子機器の電気的な安全性及び安定動作を保証するため、各種の試験項目が規定されている
###### 機器が外部に与える電磁的な影響を測定するエミッション （EMI）試験
* EMI：Electromagnetic Interference：電磁障害
    * 機器を動作させた状態で放射される電磁波の周波数と強度を測定し、その結果が規格に収まっているかを調べる
        * 規格
            * [FCC](https://ja.m.wikipedia.org/wiki/連邦通信委員会)
                * 米国の連邦通信委員会 (Federal Communications Commission)
            * [VCCI](https://ja.m.wikipedia.org/wiki/VCCI協会)
                * 日本の業界団体である。VCCIとは、かつての名称である情報処理装置等電波障害自主規制協議会(英: Voluntary Control Council for Interference by Information Technology Equipment)
            * [CISPR22](https://ja.m.wikipedia.org/wiki/国際無線障害特別委員会)
                * 国際無線障害特別委員会（フランス語でComité international spécial des perturbations radioélectriques: CISPR、シスプル）
                    * 22号：情報技術設備の無線妨害特性許容値及び測定の方法。（1997年4月）
            * EN55022
                * CISPR 22 is analog standard to European standard EN 55022
            * など
###### 外部からの影響に対するききの耐性を測定するイミュニティ（EMS）試験
* EMS：Electromagnetic Susceptibility：電磁感受性
    * 外界から受ける電気的な影響により、装置が誤動作及び破壊しないことを検証する試験である
        * 印加する外乱の種類により、複数の試験がある
            * IEC：International Electrotechnical Commission：国際電気標準会議
                * IEC 61000-4-2
                    * 静電気放電イミュニティ試験
                * IEC 61000-4-3
                    * 放射電磁界イミュニティ試験
                * IEC 61000-4-4
                    * バースト波雑音イミュニティ試験
                        * [バーストノイズは、2つかそれ以上のレベル間で（ガウス雑音的でない）突然のステップ状の遷移が起きるもので、その差は数百ミリボルト程度であり、無作為かつ予測不能なタイミングで発生する。
（音響回路でパチパチいう破裂音など）](https://ja.m.wikipedia.org/wiki/ノイズ_(電子工学))
                * IEC 61000-4-5
                    * サージ雑音イミュニティ試験
                        * [サージは、電気回路や電気系統に通常の電圧を越えて、瞬間的あるいは、断続的に発生する過電圧の事を言います。（直接雷、誘導雷サージ、開閉サージ、過電圧サージ）](https://www.otowadenki.co.jp/basic7/)
                * IEC 61000-4-6
                    * 高周波数連続伝導イミュニティ試験
                * IEC 61000-4-8
                    * 電力周波数磁界イミュニティ試験
                * IEC 61000-4-11
                    * 電圧ディップ・瞬時停電イミュニティ試験
                        * Voltage Dips / Short Interruptions. 电压暂降 / 短时中断
#### 電源関係の安全対策
##### 瞬断対策
###### UPSなど
##### 漏電・感電対策
###### 装置の中で高電圧を扱う部分がある場合、感電に対しては、これに容易に触れることのできないような構造にするなどの設計上の配慮が必要である。装置にアース線を接続することも、対策の一つである
### 信頼性設計
#### ＡＰ：０３．システム構成要素を参照
##### フォールトトレラント
###### 故障などの予期せぬ事態が発生しても、装置としてはその影響を受けずに正常な動作を続けられるようにすること
* フォールセーフ
    * JIS Z 815
        * アイテムが故障した時、予め定められた一つの安全な状態を取るような設計上の性質
            * 例：故障時に電源をシャットダウン
* フォールソフト
    * JIS Z 815
        * フォールトが存在しても、機能または性能を縮退しながらアイテムが要求機能を遂行し続ける、設計上の性質
            * 例：システムを多重化
* フォールプルーフ
    * JIS Z 815
        * 人為的に不適切な行為または過失などが起こっても、アイテムの信頼性及び安全性を保持する性質
            * 例：コネクタを逆方向に挿入できないや切欠きがあるなどで誤操作でも事故が起こさない
##### フォールトアボイダンス
###### 信頼性の高い部品を用いる、ソフトウェアの信頼性を高めると言った対策で故障が起きにくく設計する考え
##### 信頼性ブロック図
###### 直列、並列を表現し、各要素が全体の稼働率への影響度を見える
##### 稼働率
###### MTBF：Mean Time Between Failure：平均故障間隔
###### MTTR：Mean Time To Repair／Recovery：平均修理／復旧時間
##### FMEA：Failure Mode and Effect Analysis
###### 設計の不完全性や潜在的な欠陥を見出すために、システムの各構成要素の故障モードと、それが上位アイテムに及ぼす影響について示したものである
* 事象の出発点として、そこから発生する故障や災害などをボトムアップ的に明らかにする
##### FTA：Fault Tree Analysis
###### 信頼性または安全性の面から、発生が好ましくない事象について、その発生要因、発生経路及び発生確率を、論理記号を用いた樹形図に図示して解析する手法である
